<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Milkyway Bank</title>
<style>
  body { font-family: Arial, sans-serif; background:#eef2f7; margin:0; }
  header { background:#1b3a63; color:white; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; }
  main { max-width:1000px; margin:30px auto; padding:0 20px; }
  .card { background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px; }
  .flex { display:flex; flex-wrap:wrap; gap:20px; }
  label { display:block; margin-top:10px; }
  input, select { width:100%; padding:7px; margin-top:3px; box-sizing:border-box; }
  button { margin-top:12px; padding:8px 14px; background:#1b3a63; color:white; border:none; cursor:pointer; }
  button:hover { background:#244f88; }
  .hidden { display:none; }
  .status { margin-top:10px; color:#b03030; }
  .status.ok { color:#1f7a3a; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:6px; }
  th { background:#f0f3f8; }
  .tag { padding:2px 6px; border-radius:4px; background:#ddd; font-size:12px; }
  .frozen { background:#ffcccc; color:#900; }
</style>
</head>
<body>

<header>
  <h1>Milkyway Bank</h1>
  <div id="currentUserDisplay"></div>
</header>

<main>

<section id="authSection">
  <div class="flex">
    <div class="card">
      <h2>Create Account</h2>
      <label>First Name</label><input id="suFirst">
      <label>Last Name</label><input id="suLast">
      <label>Username</label><input id="suUser">
      <label>Password</label><input id="suPass" type="password">
      <button id="btnSignUp">Sign Up</button>
      <div class="status" id="suStatus"></div>
    </div>

    <div class="card">
      <h2>User Login</h2>
      <label>Username</label><input id="liUser">
      <label>Password</label><input id="liPass" type="password">
      <button id="btnLogin">Sign In</button>
      <div class="status" id="liStatus"></div>
    </div>

    <div class="card">
      <h2>Admin Login</h2>
      <label>Username</label><input id="adUser" placeholder="Admin67">
      <label>Password</label><input id="adPass" type="password">
      <button id="btnAdminLogin">Admin Sign In</button>
      <div class="status" id="adStatus"></div>
    </div>
  </div>
</section>

<section id="userSection" class="hidden">
  <div class="card">
    <h2>User Dashboard</h2>
    <p><strong>Name:</strong> <span id="uName"></span></p>
    <p><strong>Account #:</strong> <span id="uAcct"></span></p>
    <p><strong>Status:</strong> <span id="uStatusTag" class="tag"></span></p>
    <p><strong>Balance:</strong> $<span id="uBal">0.00</span></p>
    <button id="btnLogoutUser">Log Out</button>
  </div>

  <div class="flex">
    <div class="card">
      <h2>Deposit / Withdraw Request</h2>
      <label>Amount</label><input id="uAmount" type="number" step="0.01">
      <label>Type</label>
      <select id="uType">
        <option value="deposit">Deposit</option>
        <option value="withdraw">Withdraw</option>
      </select>
      <button id="btnReqDW">Submit Request</button>
      <div class="status" id="uDWStatus"></div>
    </div>

    <div class="card">
      <h2>Transfer</h2>
      <label>Target Account #</label><input id="tgtAcct">
      <label>Amount</label><input id="tAmount" type="number" step="0.01">
      <button id="btnTransfer">Transfer</button>
      <div class="status" id="uTransferStatus"></div>
      <div class="status">Note: $0.10 fee per transfer goes to admin.</div>
    </div>
  </div>
</section>

<section id="adminSection" class="hidden">
  <div class="card">
    <h2>Admin Dashboard</h2>
    <p><strong>Admin account #:</strong> <span id="adminAcctNum"></span></p>
    <p><strong>Admin balance:</strong> $<span id="adminBal">0.00</span></p>
    <button id="btnLogoutAdmin">Log Out</button>
  </div>

  <div class="card">
    <h2>Pending Deposit / Withdraw Requests</h2>
    <table>
      <thead>
        <tr>
          <th>Account #</th><th>Type</th><th>Amount</th><th>Approve</th><th>Deny</th>
        </tr>
      </thead>
      <tbody id="pendingBody"></tbody>
    </table>
  </div>

  <div class="card">
    <h2>All Accounts</h2>
    <table>
      <thead>
        <tr>
          <th>Account #</th><th>Name</th><th>User</th><th>Balance</th><th>Status</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminAccountsBody"></tbody>
    </table>
    <div class="status" id="adminStatus"></div>
  </div>
</section>

</main>

<script>
/* ===== ADMIN CONFIG ===== */
const ADMIN_USERNAME = "Admin67";
const ADMIN_PASS_B64 = "NjUzdHI3ODR5cjc5USQq"; // Base64 of 653tr784yr79Q$*

/* ===== DATABASE ===== */
const accounts = [
  {
    firstName: "Bank",
    lastName: "Admin",
    username: ADMIN_USERNAME,
    accountNumber: "0000000000",
    balance: 0,
    frozen: false,
    password: null
  }
];

const pendingRequests = []; // { account, type, amount }

let currentUser = null;
let isAdmin = false;

/* ===== HELPERS ===== */
function genAccountNumber() {
  let n = "";
  for (let i = 0; i < 10; i++) n += Math.floor(Math.random() * 10);
  return n;
}
function money(v) { return Number(v).toFixed(2); }
function findUser(u) { return accounts.find(a => a.username === u); }
function findAcct(n) { return accounts.find(a => a.accountNumber === n); }
function getAdminAccount() { return accounts[0]; }
function toBase64(str) { return btoa(str); }

function showSection(id) {
  document.getElementById("authSection").classList.add("hidden");
  document.getElementById("userSection").classList.add("hidden");
  document.getElementById("adminSection").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

function refreshUserUI() {
  document.getElementById("uName").textContent = currentUser.firstName + " " + currentUser.lastName;
  document.getElementById("uAcct").textContent = currentUser.accountNumber;
  document.getElementById("uBal").textContent = money(currentUser.balance);
  const tag = document.getElementById("uStatusTag");
  tag.textContent = currentUser.frozen ? "Frozen" : "Active";
  tag.className = "tag" + (currentUser.frozen ? " frozen" : "");
  document.getElementById("currentUserDisplay").textContent = "Signed in: " + currentUser.username;
}

function refreshAdminHeader() {
  const adminAcc = getAdminAccount();
  document.getElementById("adminAcctNum").textContent = adminAcc.accountNumber;
  document.getElementById("adminBal").textContent = money(adminAcc.balance);
  document.getElementById("currentUserDisplay").textContent = "Admin: " + ADMIN_USERNAME;
}

function refreshPending() {
  const body = document.getElementById("pendingBody");
  body.innerHTML = "";
  pendingRequests.forEach((req, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${req.account}</td>
      <td>${req.type}</td>
      <td>$${money(req.amount)}</td>
      <td><button class="approveBtn">Approve</button></td>
      <td><button class="denyBtn">Deny</button></td>
    `;
    body.appendChild(tr);

    tr.querySelector(".approveBtn").onclick = () => {
      const acc = findAcct(req.account);
      if (!acc) return;

      if (req.type === "deposit") {
        acc.balance += req.amount;
      } else if (req.type === "withdraw") {
        if (acc.balance >= req.amount) {
          acc.balance -= req.amount;
        }
      }
      pendingRequests.splice(index, 1);
      refreshPending();
      refreshAdminTable();
      refreshAdminHeader();
    };

    tr.querySelector(".denyBtn").onclick = () => {
      pendingRequests.splice(index, 1);
      refreshPending();
    };
  });
}

function refreshAdminTable() {
  const body = document.getElementById("adminAccountsBody");
  const status = document.getElementById("adminStatus");
  body.innerHTML = "";
  accounts.forEach(acc => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${acc.accountNumber}</td>
      <td>${acc.firstName} ${acc.lastName}</td>
      <td>${acc.username}</td>
      <td>$${money(acc.balance)}</td>
      <td><span class="tag ${acc.frozen ? "frozen" : ""}">${acc.frozen ? "Frozen" : "Active"}</span></td>
      <td>
        <input type="number" step="0.01" placeholder="New balance" class="balInput">
        <button class="setBal">Set</button>
        <button class="freezeBtn">${acc.frozen ? "Unfreeze" : "Freeze"}</button>
      </td>`;
    body.appendChild(tr);

    const inp = tr.querySelector(".balInput");
    tr.querySelector(".setBal").onclick = () => {
      const val = parseFloat(inp.value);
      if (isNaN(val) || val < 0) {
        status.textContent = "Enter a valid non-negative balance.";
        status.className = "status";
        return;
      }
      acc.balance = val;
      status.textContent = "Balance updated.";
      status.className = "status ok";
      refreshAdminTable();
      refreshAdminHeader();
    };

    tr.querySelector(".freezeBtn").onclick = () => {
      acc.frozen = !acc.frozen;
      status.textContent = "Account updated.";
      status.className = "status ok";
      refreshAdminTable();
    };
  });
}

/* ===== SIGN UP ===== */
document.getElementById("btnSignUp").onclick = () => {
  const first = document.getElementById("suFirst").value.trim();
  const last = document.getElementById("suLast").value.trim();
  const user = document.getElementById("suUser").value.trim();
  const pass = document.getElementById("suPass").value;
  const st = document.getElementById("suStatus");

  if (!first || !last || !user || !pass) {
    st.textContent = "All fields required.";
    st.className = "status";
    return;
  }
  if (findUser(user)) {
    st.textContent = "Username taken.";
    st.className = "status";
    return;
  }

  const acctNum = genAccountNumber();
  accounts.push({
    firstName: first,
    lastName: last,
    username: user,
    password: pass,
    accountNumber: acctNum,
    balance: 0,
    frozen: false
  });

  st.textContent = "Account created! #" + acctNum;
  st.className = "status ok";
  document.getElementById("suFirst").value =
    document.getElementById("suLast").value =
    document.getElementById("suUser").value =
    document.getElementById("suPass").value = "";
};

/* ===== USER LOGIN ===== */
document.getElementById("btnLogin").onclick = () => {
  const user = document.getElementById("liUser").value.trim();
  const pass = document.getElementById("liPass").value;
  const st = document.getElementById("liStatus");
  const acc = findUser(user);

  if (!acc || acc.password !== pass || acc.username === ADMIN_USERNAME) {
    st.textContent = "Invalid login.";
    st.className = "status";
    return;
  }

  currentUser = acc;
  isAdmin = false;
  st.textContent = "";
  showSection("userSection");
  refreshUserUI();
};

/* ===== ADMIN LOGIN ===== */
document.getElementById("btnAdminLogin").onclick = () => {
  const user = document.getElementById("adUser").value.trim();
  const pass = document.getElementById("adPass").value;
  const st = document.getElementById("adStatus");

  if (user !== ADMIN_USERNAME) {
    st.textContent = "Invalid admin login.";
    st.className = "status";
    return;
  }

  if (toBase64(pass) !== ADMIN_PASS_B64) {
    st.textContent = "Invalid admin login.";
    st.className = "status";
    return;
  }

  isAdmin = true;
  currentUser = null;
  st.textContent = "";
  showSection("adminSection");
  refreshAdminTable();
  refreshPending();
  refreshAdminHeader();
};

/* ===== LOGOUTS ===== */
document.getElementById("btnLogoutUser").onclick = () => {
  currentUser = null;
  isAdmin = false;
  document.getElementById("currentUserDisplay").textContent = "";
  showSection("authSection");
};
document.getElementById("btnLogoutAdmin").onclick = () => {
  currentUser = null;
  isAdmin = false;
  document.getElementById("currentUserDisplay").textContent = "";
  showSection("authSection");
};

/* ===== USER REQUEST: DEPOSIT / WITHDRAW ===== */
document.getElementById("btnReqDW").onclick = () => {
  if (!currentUser) return;
  const amt = parseFloat(document.getElementById("uAmount").value);
  const type = document.getElementById("uType").value;
  const st = document.getElementById("uDWStatus");

  if (currentUser.frozen) {
    st.textContent = "Account frozen.";
    st.className = "status";
    return;
  }
  if (isNaN(amt) || amt <= 0) {
    st.textContent = "Invalid amount.";
    st.className = "status";
    return;
  }

  pendingRequests.push({
    account: currentUser.accountNumber,
    type: type,
    amount: amt
  });

  st.textContent = "Request submitted for admin approval.";
  st.className = "status ok";
  document.getElementById("uAmount").value = "";
  if (isAdmin) refreshPending();
};

/* ===== TRANSFER (instant, with $0.10 fee) ===== */
document.getElementById("btnTransfer").onclick = () => {
  if (!currentUser) return;
  const tgt = document.getElementById("tgtAcct").value.trim();
  const amt = parseFloat(document.getElementById("tAmount").value);
  const st = document.getElementById("uTransferStatus");
  const fee = 0.10;

  if (currentUser.frozen) {
    st.textContent = "Account frozen.";
    st.className = "status";
    return;
  }
  if (!tgt || isNaN(amt) || amt <= 0) {
    st.textContent = "Invalid input.";
    st.className = "status";
    return;
  }

  const targetAcc = findAcct(tgt);
  if (!targetAcc) {
    st.textContent = "Target not found.";
    st.className = "status";
    return;
  }
  if (targetAcc.frozen) {
    st.textContent = "Target frozen.";
    st.className = "status";
    return;
  }

  const total = amt + fee;
  if (currentUser.balance < total) {
    st.textContent = "Insufficient funds.";
    st.className = "status";
    return;
  }

  const adminAcc = getAdminAccount();
  currentUser.balance -= total;
  targetAcc.balance += amt;
  adminAcc.balance += fee;

  st.textContent = "Transfer complete.";
  st.className = "status ok";
  document.getElementById("tgtAcct").value = "";
  document.getElementById("tAmount").value = "";
  refreshUserUI();
  refreshAdminHeader();
};
</script>

</body>
</html>
